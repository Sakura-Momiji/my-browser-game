<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>シミュレーション準備段階</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #fafafa; }
  #board {
    display: grid;
    margin: 20px auto;
    border: 2px solid #333;
  }
  .cell {
    width: 50px; height: 50px;
    border: 1px solid #ccc;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 12px;
    position: relative;
  }
  .label-x { position: absolute; top: -15px; left: 2px; font-size: 10px; color: #555; }
  .label-y { position: absolute; left: -15px; top: 2px; font-size: 10px; color: #555; }
  .red { background: #f88; }
  .blue { background: #88f; color: white; }
  .abyss { background: black; }
  .respawn-red { background: pink; }
  .respawn-blue { background: lightblue; }

  .modal {
    display: none; position: fixed; top:0; left:0;
    width:100%; height:100%; background: rgba(0,0,0,0.5);
    justify-content: center; align-items: center;
  }
  .modal-content {
    background: white; padding: 20px; border-radius: 10px; width: 300px;
    text-align: left; position: relative;
  }
  .closeBtn { position: absolute; top:5px; right:10px; cursor: pointer; color: red; }
</style>
</head>
<body>
  <h1>シミュレーション準備段階（ステップ1）</h1>
  <button id="settingsBtn">設定</button>
  <div id="board"></div>

  <!-- 配置モーダル -->
  <div id="placeModal" class="modal">
    <div class="modal-content">
      <span class="closeBtn" id="closePlace">×</span>
      <h2 id="modalTitle">配置</h2>
      <label>
        種類:
        <select id="typeSelect">
          <option value="piece">コマ</option>
          <option value="gimmick">ギミック</option>
        </select>
      </label>
      <div id="pieceOptions">
        <label>色:
          <select id="pieceColor">
            <option value="red">赤</option>
            <option value="blue">青</option>
          </select>
        </label><br>
        <label>種類:
          <select id="pieceType">
            <option>ポーン</option>
            <option>ナイト</option>
            <option>ルーク</option>
            <option>クイーン</option>
            <option>キング</option>
          </select>
        </label><br>
        <label>名前:<input type="text" id="pieceName"></label>
      </div>
      <div id="gimmickOptions" style="display:none;">
        <label>種類:
          <select id="gimmickType">
            <option value="abyss">奈落</option>
            <option value="respawn">リスポーンエリア</option>
          </select>
        </label><br>
        <label id="respawnColorLabel">色:
          <select id="respawnColor">
            <option value="red">赤</option>
            <option value="blue">青</option>
          </select>
        </label>
      </div>
      <br>
      <button id="applyPlace">適用</button>
    </div>
  </div>

  <script>
    const board = document.getElementById("board");
    const placeModal = document.getElementById("placeModal");
    const closePlace = document.getElementById("closePlace");
    const typeSelect = document.getElementById("typeSelect");
    const pieceOptions = document.getElementById("pieceOptions");
    const gimmickOptions = document.getElementById("gimmickOptions");
    const pieceColor = document.getElementById("pieceColor");
    const pieceType = document.getElementById("pieceType");
    const pieceName = document.getElementById("pieceName");
    const gimmickType = document.getElementById("gimmickType");
    const respawnColor = document.getElementById("respawnColor");
    const applyPlace = document.getElementById("applyPlace");

    let boardSize = 5;
    let selectedCell = null;

    function createBoard(size){
      board.innerHTML = "";
      board.style.gridTemplateColumns = `repeat(${size}, 50px)`;
      for(let y=0;y<size;y++){
        for(let x=0;x<size;x++){
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.x = x;
          cell.dataset.y = y;

          // 座標ラベル
          if(y===0){
            const lx = document.createElement("span");
            lx.className="label-x";
            lx.textContent = numToCol(x);
            cell.appendChild(lx);
          }
          if(x===0){
            const ly = document.createElement("span");
            ly.className="label-y";
            ly.textContent = y+1;
            cell.appendChild(ly);
          }

          cell.addEventListener("click", () => {
            selectedCell = cell;
            pieceName.value = "";
            placeModal.style.display="flex";
          });
          board.appendChild(cell);
        }
      }
    }

    function numToCol(n){
      let s="";
      while(n>=0){
        s=String.fromCharCode(n%26+65)+s;
        n=Math.floor(n/26)-1;
      }
      return s;
    }

    // モーダル切替
    typeSelect.onchange = () => {
      if(typeSelect.value==="piece"){
        pieceOptions.style.display="block";
        gimmickOptions.style.display="none";
      }else{
        pieceOptions.style.display="none";
        gimmickOptions.style.display="block";
      }
    };

    // 適用
    applyPlace.onclick = () => {
      if(!selectedCell) return;
      selectedCell.className="cell"; // reset
      selectedCell.textContent="";
      if(typeSelect.value==="piece"){
        let color = pieceColor.value;
        let name = pieceName.value || pieceType.value;
        selectedCell.classList.add(color);
        selectedCell.textContent=name;
      }else{
        if(gimmickType.value==="abyss"){
          selectedCell.classList.add("abyss");
        }else{
          let color = respawnColor.value;
          selectedCell.classList.add("respawn-"+color);
          selectedCell.textContent="R";
        }
      }
      placeModal.style.display="none";
    };

    closePlace.onclick = ()=> placeModal.style.display="none";

    createBoard(boardSize);
  </script>
</body>
</html>
